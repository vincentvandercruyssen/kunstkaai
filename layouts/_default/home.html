{{ define "main" }}
<style>
  header {
    display: none;
  }

  main {
    grid-column: 1 / 3;
    margin: 0;
    padding: 1rem;
  }

  .grid-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
  }

  .folder {
    max-height: 70vh;
    overflow-y: scroll;
    mask-image: linear-gradient(180deg, black 95%, transparent);
  }

  h3 {
    overflow: hidden;
    max-width: 20ch;
    font-size: 1.5rem;
    white-space: nowrap;
    text-overflow: ellipsis;
  }

  h4 {
    font-size: 1.2rem;
  }

  time.pill {
    opacity: 0.5;
    font-size: 0.9rem;
  }
</style>

{{/* Top-level sections = jaren (nieuwste eerst) */}}
{{ range .Site.Sections.ByTitle.Reverse }}
  <section class="year">
    <h2>{{ .Title | default .Section }}</h2>

    {{/* alle paginaâ€™s onder dit jaar, zonder op sections te vertrouwen */}}
    {{ $yearPages := .RegularPagesRecursive }}
    {{ $yearSegs := split (trim .RelPermalink "/") "/" }}
    {{ $year := index $yearSegs 0 }}

    {{/* unieke vakkeys (2e URL-segment), enkel vakken die je benoemt in params.sectionNames */}}
    {{ $vakKeys := slice }}
    {{ range $yearPages }}
      {{ $s := split (trim .RelPermalink "/") "/" }}
      {{ if ge (len $s) 2 }}
        {{ $vak := index $s 1 }}
        {{ if and (index $.Site.Params.sectionNames $vak) (not (in $vakKeys $vak)) }}
          {{ $vakKeys = $vakKeys | append $vak }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{ $vakKeys = sort $vakKeys }}

    <div class="grid-container">
      {{ range $vakKeys }}
        {{ $vak := . }}
        <div class="folder">
          <h3>{{ index $.Site.Params.sectionNames $vak }}</h3>

          {{/* ---------- CURSUS op vakniveau: /jaar/vak/cursus/... ---------- */}}
          <div class="cursus">
            <h4>Cursusmateriaal</h4>
            <ul>
              {{ $cursusPrefix := printf "/%s/%s/cursus/" $year $vak }}
              {{ range sort $yearPages "Date" "desc" }}
                {{ if in .RelPermalink $cursusPrefix }}
                  <li>
                    <a href="{{ .Permalink }}" target="_blank">{{ .Title | default .File.BaseFileName }}</a>
                  </li>
                {{ end }}
              {{ end }}
            </ul>
          </div>

          {{/* ---------- OPDRACHTEN per KLAS: /jaar/vak/<klas>/opdracht/... ---------- */}}
          {{/* eerst unieke klassen verzamelen */}}
          {{ $klassen := slice }}
          {{ range $yearPages }}
            {{ if in .RelPermalink "/opdracht/" }}
              {{ $p := split (trim .RelPermalink "/") "/" }}
              {{ if and (ge (len $p) 4) (eq (index $p 0) $year) (eq (index $p 1) $vak) }}
                {{ $klass := index $p 2 }}
                {{ if not (in $klassen $klass) }}{{ $klassen = $klassen | append $klass }}{{ end }}
              {{ end }}
            {{ end }}
          {{ end }}
          {{ $klassen = sort $klassen }}

          {{ range $klassen }}
            {{ $klass := . }}
            <div class="opdracht">
              <h4>Opdrachten ({{ upper $klass }})</h4>
              <ul>
                {{ $klassPrefix := printf "/%s/%s/%s/" $year $vak $klass }}
                {{ range sort $yearPages "Date" "desc" }}
                  {{ if and (in .RelPermalink $klassPrefix) (in .RelPermalink "/opdracht/") }}
                    <li>
                      <a href="{{ .Permalink }}" target="_blank">
                        {{ .Title | default .File.BaseFileName }}
                      </a> <br>
                      <time datetime="{{ .Date | time.Format $.Site.Params.dateFormatISO }}" class="pill">{{ .Date | time.Format $.Site.Params.dateFormat }}</time>
                    </li>
                  {{ end }}
                {{ end }}
              </ul>
            </div>
          {{ end }}
        </div>
      {{ end }}
    </div>
  </section>
{{ end }}
{{ end }}